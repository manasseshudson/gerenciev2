<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width initial-scale=1.0">
    <title><%= title %></title>
    <link href="/assets/vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/assets/vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet" />
    <link href="/assets/vendors/themify-icons/css/themify-icons.css" rel="stylesheet" />
    <link href="/assets/vendors/jvectormap/jquery-jvectormap-2.0.3.css" rel="stylesheet" />
    <link href="/assets/css/main.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.4/css/dataTables.dataTables.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.0/sweetalert.min.js"></script>
    <style>
        .content-wrapper {
            position: relative;
            background-color: #f7f7f7;
            background-color: #f2f2f2;
            background-color: #f1f1f1;
            margin-left: 200px;
            padding: 0 15px 60px 15px;
                padding-top: 0px;
            -webkit-transition: margin .2s ease-in-out;
            -o-transition: margin .2s ease-in-out;
            transition: margin .2s ease-in-out;
            min-height: 1000px;
            }
        .page-footer {
              position: absolute;
              left: 10px;
              bottom: 0;
              width: 100%;
              display: -webkit-box;
              display: -webkit-flex;
              display: -ms-flexbox;
              display: flex;
              -webkit-box-pack: justify;
              -webkit-justify-content: space-between;
              -ms-flex-pack: justify;
              justify-content: space-between;
              -webkit-box-align: center;
              -webkit-align-items: center;
              -ms-flex-align: center;
              align-items: center;
              padding: 10px 15px;
              background-color: #fff;
            }
            .badge {
              display: inline-block;
              padding: .25em .4em;
              font-size: 75%;
              font-weight: 700;
              line-height: 1;
              color: #fff;
              text-align: center;
              white-space: nowrap;
              vertical-align: baseline;
              border-radius: .25rem;
              min-width: 80px;
              padding: 5px;
            }
            .h4, h4 {
            font-size: 14px;
          }
    </style>
</head>

<body class="fixed-navbar sidebar-mini">
    <div class="page-wrapper">
        <!-- START HEADER-->
        <header class="header">
            <div class="page-brand">
              <%- include('./../partials/logo.ejs') %>
            </div>
            <div class="flexbox flex-1">
                <!-- START TOP-LEFT TOOLBAR-->
                <ul class="nav navbar-toolbar">
                    <li>
                        <a class="nav-link sidebar-toggler js-sidebar-toggler"><i class="ti-menu"></i></a>
                    </li>
                    <li>
                       
                    </li>
                </ul>
                <!-- END TOP-LEFT TOOLBAR-->
                <!-- START TOP-RIGHT TOOLBAR-->
                <ul class="nav navbar-toolbar">
                    
                </ul>
                <!-- END TOP-RIGHT TOOLBAR-->
            </div>
        </header>
        <!-- END HEADER-->
        <!-- START SIDEBAR-->
        <nav class="page-sidebar" id="sidebar">
            <div id="sidebar-collapse">
                <div class="admin-block d-flex">
                    <div>
                        <img src="/assets/img/admin-avatar.png" width="45px" />
                    </div>
                    <div class="admin-info">
                        <div class="font-strong">
							<%= user %>
						</div>
						<small>Administrator</small></div>
                </div>
                <%- include('./../partials/sidebar.ejs') %>
            </div>
        </nav>
        <!-- END SIDEBAR-->
        <div class="content-wrapper">
            <!-- START PAGE CONTENT-->
            <div class="page-content fade-in-up">
				<div class="col-lg-12">
                    <div class="ibox">
                        <div class="ibox-head">
                            <div class="ibox-title">Lancamentos Realizados de : <%= clienteNome %></div>                            
                        </div>
                        <div class="ibox-body">
							<div class="row">
								<div class="col-lg-6 col-md-6">
									<div class="ibox bg-success color-white widget-stat">
										<div class="ibox-body">
											<h2 class="m-b-5 font-strong">
												<% if(total_recebido=="null"){ %>
													0
												<% }else{ %>
													<%= total_recebido %>
												<% } %>
												</h2>
											<div class="m-b-5">Lancamentos Recebidos</div><i class="ti-bar-chart widget-stat-icon"></i>
											<!--<div><i class="fa fa-level-up m-r-5"></i><small>25% higher</small></div>-->
										</div>
									</div>
								</div>
								<div class="col-lg-6 col-md-6">
									<div class="ibox bg-danger color-white widget-stat">
										<div class="ibox-body">
											<h2 class="m-b-5 font-strong"><%= total_receber %></h2>
											<div class="m-b-5">Lancamentos a Receber</div><i class="ti-bar-chart widget-stat-icon"></i>
											<!--<div><i class="fa fa-level-up m-r-5"></i><small>17% higher</small></div>-->
										</div>
									</div>
								</div>
							</div>
							<div class="row">
								<div class="col-lg-12">
									<div class="ibox">
										<div class="ibox-head" style="display: none;">
											
										</div>
										<div class="ibox-body">
										  <table class="table datatable" id="datatable">
											<thead>
											  <tr>
												<th>Documento</th>
												<th>Valor</th>
												<th>Data</th>
												<th>Vencimento</th>
												<th>Pagamento</th>
												<th>Observação</th>
												<th></th>
												<th></th>
												<th></th>
												<th></th>
												<!--<th></th>-->
											  </tr>
											</thead>
											<tbody>
												<% lancamentos.forEach(dados=>{ %>
											  <tr>
												
												<td><%= dados.documento %></td>
												<td><%= dados.valor %></td>
												<td><%= dados.data_externa %></td>
												<td><%= dados.data_vencimento_externa %></td>
												<td><%= dados.data_pagamento_externa %></td>
												<td><%= dados.observacao %></td>
												<td style="width: 2%;"><a href="/adm/lancamentos_cliente_detalhes/<%= dados.id_lancamento %>/<%= uid_usuario %>/<%= id_cliente %>"><span class="badge bg-warning" >detalhes</span></a></td>
												
												<% if(dados.status==1){ %>
													<td style="width: 2%;"><a href=""><span class="badge bg-success" >Recebido</span></a></td>
													<td style="width: 2%;"></td>
													<!--<td style="width: 2%;"><a href="/adm/editLancamento/<%= dados.id_lancamento %>/<%= uid_usuario %>"><span class="badge bg-warning" >Editar</span></a></td>-->
													<td style="width: 2%;"><a href="/adm/editPdv/<%= uid_usuario %>/<%= dados.documento %>"><span class="badge bg-warning" >Editar</span></a></td>
													<!--<td style="width: 2%;"><a href="/adm/remLancamento/<%= dados.id_lancamento %>/<%= uid_usuario %>"><span class="badge bg-danger">Excluir</span></a></td> -->
												<% }else{ %>
													<td style="width: 2%;"><a href="/adm/receberLancamentoParcial/<%= dados.id_lancamento %>/<%= uid_usuario %>"><span class="badge bg-danger" >Receber Parcial</span></a></td>
													<td style="width: 2%;"><a href="/adm/receberLancamentoTotal/<%= dados.id_lancamento %>/<%= uid_usuario %>"><span class="badge bg-danger" >Receber Total</span></a></td>
													<!--<td style="width: 2%;"><a href="/adm/editLancamento/<%= dados.id_lancamento %>/<%= uid_usuario %>"><span class="badge bg-warning" >Editar</span></a></td>-->
													<td style="width: 2%;"><a href="/adm/editPdv/<%= uid_usuario %>/<%= dados.documento %>"><span class="badge bg-warning" >Editar</span></a></td>
													<!--<td style="width: 2%;"><a href="/adm/remLancamento/<%= dados.id_lancamento %>/<%= uid_usuario %>"><span class="badge bg-danger">Excluir</span></a></td>     -->                           
												<% } %>
											  </tr>
											  <% }) %>
											</tbody>
										  </table>
										</div>
									</div>
								   
								</div>
							</div>
						</div>
					</div>
				</div>
			
			
				
                
               
            </div>
            <!-- END PAGE CONTENT-->
            <%- include('./../partials/footer.ejs') %>
        </div>
    </div>

    <div class="modal fade " id="modalExemplo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog  modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Adicionar Lançamentos</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
          <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="formulario" action="javascript:func()" method="post">
            <input type="hidden" id="uid_usuario" value="<%= uid_usuario %>" >				
            <input type="hidden" id="id_empresa" value="<%= id_empresa %>" >
            <div class="row">
              <div class="col-md-12">
                <h4 class="card-inside-title ">Cliente</h4>
                
                <div class="form-group">
                                      
                                      <select class="form-control select2" style="width: 100%;"  id="id_cliente">
                      <option value="0" selected> Selecione </option>
                                          <% cliente.forEach( dados=> { %>
                        <option value="<%= dados.id_cliente %>"><%= dados.nome %></option>
                      <% }) %>
                                      </select>
                                  </div>
              </div>
            </div>
  
            <div class="row">
              <div class="col-sm-4">
                <h4 class="card-inside-title ">Documento</h4>
                <div class="form-group">
                  <div class="form-line">
                    <input type="text" class="form-control"  id="documento" />
                  </div>
                </div>
              </div>
              <div class="col-sm-3" >
                <h4 class="card-inside-title">Data </h2>
                <div class="form-group">
                  <div class="form-line">
                    <input type="text" class="form-control date" id="data_atual" />
                  </div>
                </div>
              </div>
              <div class="col-sm-3" >
                <h4 class="card-inside-title">Vencimento </h2>
                <div class="form-group">
                  <div class="form-line">
                    <input type="text" class="form-control date" id="data_vencimento" />
                  </div>
                </div>
              </div>						
              <div class="col-sm-2">
                <h4 class="card-inside-title ">Valor</h4>
                <div class="form-group">
                  <div class="form-line">
                    <input type="text" class="form-control money" placeholder="0.00" id="valor" />
                  </div>
                </div>
              </div>
            </div>
            
            <div class="row">	
              
              
            </div>
            <div class="row">
              
              <div class="col-md-12">
                <div class="form-group">
                  <label>Observação</label>
                  <textarea class="form-control" rows="3" id="observacao"></textarea>
                </div>
              </div>
            </div>
  
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
          <button class="btn btn-primary" type="submit" id="salvarLancamento"><i class="fa fa-fw fa-lg fa-check-circle"></i>Cadastrar</button>&nbsp;&nbsp;&nbsp;
        </div>
        </div>
      </div>
    </div>
  
    <!-- BEGIN PAGA BACKDROPS-->
    <div class="sidenav-backdrop backdrop"></div>
    <div class="preloader-backdrop">
        <div class="page-preloader">Loading</div>
    </div>
    <!--<script src="https://cdn.pulse.is/livechat/loader.js" data-live-chat-id="66aa151bf95a4ee6a60ad515" async></script>-->
    <script src="/assets/vendors/jquery/dist/jquery.min.js" type="text/javascript"></script>
    <script src="/assets/jquery.mask.min.js"></script>
    <script src="/assets/vendors/popper.js/dist/umd/popper.min.js" type="text/javascript"></script>
    <script src="/assets/vendors/bootstrap/dist/js/bootstrap.min.js" type="text/javascript"></script>
    <script src="/assets/vendors/metisMenu/dist/metisMenu.min.js" type="text/javascript"></script>
    <script src="/assets/js/app.min.js" type="text/javascript"></script>  
    <script src="/assets/dataTables.js"></script>

    <script type="text/javascript">
      $(document).ready(function() {
  
              $('#datatable').DataTable({
                'paging'      : true,
                'lengthChange': false,
                'searching'   : true,
                'ordering'    : false,
                'info'        : false,
                'autoWidth'   : false,
                language: {
                  url: 'https://cdn.datatables.net/plug-ins/2.0.3/i18n/pt-PT.json'
                }
            })
  
        $('#valor').mask('000.000.000.000.000,00', {reverse: true});
        $("#data_atual").mask("00/00/0000");
        $("#data_vencimento").mask("00/00/0000");
        var getData = dataAtual();			
        document.getElementById("data_atual").value = getData;
        function dataAtual(){
          var data = new Date();
          var dia = String(data.getDate()).padStart(2, '0');
          var mes = String(data.getMonth() + 1).padStart(2, '0');
          var ano = data.getFullYear();
          dataAtual = dia + '/' + mes + '/' + ano;			   
          return dataAtual;
        }
        
        
        $("#salvarLancamento").click(function(){
          var uid = $("#uid_usuario").val();			
          var id_empresa = $("#id_empresa").val();			
          var id_cliente = $("#id_cliente").val();
          var valor = $("#valor").val();	
          
          if(id_cliente=="0"){
            $("body").overhang({
              type: "error",
              message: "Informe o cliente",
              duration: 2
            });
            return;
          }
          
          if(valor===undefined || valor==""){
            $("body").overhang({
              type: "error",
              message: "Informe o valor",
              duration: 2
            });
            return;
          }
          var documento = $("#documento").val();				
          var data_lancamento = $("#data_atual").val();	
          var data_vencimento = $("#data_vencimento").val();					
          var observacao = $("#observacao").val();					
          
                  $.post('/adm/addLancamento', {
                      uid_usuario: uid,
                      id_empresa: id_empresa,
                      id_cliente: id_cliente,
                      documento: documento,
                      data: data_lancamento,
                      data_vencimento: data_vencimento, 
                      valor: valor.replace(',','.'),
                      observacao: observacao
                      
                  }, function(resposta) {
                      swal("Lançamento Realizado com Sucesso");
                      setTimeout(() => {
                          window.location.href = "/adm/lancamentos/"+uid;
                      }, "2000");
                  });
  
        })
        
      })
    </script>
</body>

</html>